impor time
import sys
import mariadb
import numpy as np

import getth #or getth_sim as getth

def mariadb_cursor():
    try:
        conn = mariadb.connect(
            user = "kodex",
            password = "vanevan3",
            host = "localhost",
            port = 3306,
            database = "rpi",
            autocommit = True,
        )
    except mariadb.Error as e:
        print(f"Exit with error:\n{e}")
        sys.exit(1)

    return conn.cursor()


def mariadb_inserts():
    cur = mariadb_cursor()
    pause_seconds = 0.25
    
    while True:
        try:
            t = getth.get_temp()
            h = getth.get_humi()
            qry = f"INSERT INTO temphumi (temp, humi) VALUES ({t}, {h})"
            cur.execute(qry)
            if __name__ == "__main__":
                print(f"Timestamp: {time.strftime('%T')}\nTemperature: {t}CÂ°  \nHumidity: {h} %")

        except ValueError as e:
            print(f"Fail: \n{e}")
        
        time.sleep(pause_seconds)


if __name__ == "__main__":
    print("Staring as __main__:")
    mariadb_inserts()
